server {
    listen 80;
    server_name localhost;

    # Root pour servir les fichiers statiques
    root /usr/share/nginx/html;
    index index.html;

    # Headers CORS pour MCP
    add_header Access-Control-Allow-Origin *;
    add_header Access-Control-Allow-Methods "GET, POST, OPTIONS";
    add_header Access-Control-Allow-Headers "Content-Type, Authorization";

    # Health check
    location /health {
        return 200 '{"status":"ok","gateway":"recherche-eu"}';
        add_header Content-Type application/json;
    }

    # Catalogue MCP Gateway Recherche EU
    location /mcp-gateway/recherche-eu {
        alias /usr/share/nginx/html/mcp-gateway/recherche-eu;
        autoindex on;
        autoindex_format json;
        
        # Servir les fichiers YAML avec le bon content-type
        location ~ \.(yaml|yml)$ {
            add_header Content-Type application/x-yaml;
            add_header Access-Control-Allow-Origin *;
        }
        
        # Servir les fichiers JSON
        location ~ \.json$ {
            add_header Content-Type application/json;
            add_header Access-Control-Allow-Origin *;
        }
    }

    # Catalogue principal (alias)
    location /catalog {
        alias /usr/share/nginx/html/mcp-gateway/recherche-eu/catalog-docker-mcp.yaml;
        add_header Content-Type application/x-yaml;
        add_header Access-Control-Allow-Origin *;
    }

    # Documentation
    location /docs {
        alias /usr/share/nginx/html/mcp-gateway/recherche-eu/README.md;
        add_header Content-Type text/markdown;
    }

    # Page d'accueil
    location / {
        try_files $uri $uri/ /mcp-gateway/recherche-eu/index.html =404;
    }
}
